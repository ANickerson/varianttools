# Copyright (C) 2013 Bo Peng (bpeng@mdanderson.org)
# Distributed under GPL. see <http://www.gnu.org/licenses/>
#
# Please refer to http://varianttools.sourceforge.net/Pipeline/New for
# a description of the format of this file.

[pipeline description]
description=A pipeline to simulate case control samples by expanding a 
	pool of haplotypes from the 1000 genomes project.

model_description=This simulation model download one or more regions
  of genotype data from the 1000 genomes project, expand it rapidly
  to get a large population, apply a disease model 
  to annotate it, and imports the EFF info as an information field. This
  pipeline requires a prior installation of snpEff but it will download
  appropriate snpEff database (e.g. hg19) automatically.

[DEFAULT]
regions=
regions_comment=One or more chromosome regions (separated by ';') in the format of
  chr:start-end (e.g. chr21:33,031,597-33,041,570), or Field:Value from a region-based
  annotation database (e.g. refGene.name2:TRIM2 or refGene_exon.name:NM_000947).
  Multiple chromosomal regions will be selected if the name matches more
  than one chromosomal regions. The regions will be marked by their indexes
  but values from another field will be used if its name is appended
  (e.g. refGene.name2:BRCA2:name will mark each regions with name of isoforms).
  Chromosome positions are 1-based and are inclusive at both ends so the 
  chromosome region has a length of end-start+1 bp.'

[model_0]
action=RunCommand('vtools use refGene')
comment=Link the refGene database to the project

[model_5]
action=ExtractFromVcf(
	'ftp://ftp.1000genomes.ebi.ac.uk/vol1/ftp/release/20100804/ALL.2of4intersection.20100804.genotypes.vcf.gz',
	regions='%(regions)s', output='cache/temp.vcf')
output='cache/temp.vcf'
comment=Extract specified regions from the 1000 genomes genotype file.

[model_10]
action=VcfToPop(regions='%(regions)s', output='cache/temp.pop')
comment=Convert downloaded genotype files to simuPOP populations


[model_20]
action=EvolvePop(output='cache/temp1.pop',
    mu=1e-4, 
    selector=ProteinSelector('%(regions)s'),
    recRate=1e-8,
	demoModel = MultiStageModel([
        InstantChangeModel(T=100, N0=200),
        ExponentialGrowthModel(T=100, NT=1000)
     ]))
comment=Evolve and expand a population

[model_30]
action=PopToVcf(output=['cache/temp1.vcf', 'cache/temp1.phenotype'])
comment=Export evolved population to an vcf file

[model_40]
action=RunCommand('vtools import ${INPUT:INPUT[0]}')
comment=Import the vcf to the current project




